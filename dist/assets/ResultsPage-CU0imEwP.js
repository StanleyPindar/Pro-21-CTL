import{i as G,q as I,k as K,r as y,j as e,M as Q,B as J,d as X,o as L,S as Z,C as ee,E as se,t as te}from"./index-BtruPY50.js";import{E as ie}from"./EmailCaptureModal-Hv-wUzSl.js";import{U as ae}from"./UserService-V1tVTsJE.js";import{L as re}from"./lock-BfwCluQ8.js";import"./user-C_8IjWSk.js";const me=()=>{const U=G(),_=I(),{clinics:S}=K(),d=new URLSearchParams(_.search),x=d.get("condition")||"",m=d.get("budget")||"",u=d.get("location")||"",N=d.get("urgency")||"",[A,q]=y.useState([]),[D,z]=y.useState(!0),[l,Y]=y.useState(!1),[O,C]=y.useState(!1);y.useEffect(()=>{if(S.length===0)return;z(!0);const r=S.map(t=>{var h,p,g,f,v,b,w,j,c,R,F,P,B,T;let a=0,i=[];x&&((p=(h=t.services)==null?void 0:h.specialties)!=null&&p.some(H=>H.toLowerCase().includes(x.toLowerCase().replace("-"," "))))&&(a+=40,i.push(`Specializes in ${x.replace("-"," ")} treatment`));const k=((f=(g=t.pricing)==null?void 0:g.initialConsultation)==null?void 0:f.price)||0,E=((b=(v=t.pricing)==null?void 0:v.estimatedAnnualCost)==null?void 0:b.average)||0,n=k/6+E/12;(m==="under-150"&&n<=150||m==="150-250"&&n>=150&&n<=250||m==="250-400"&&n>=250&&n<=400||m==="400-plus"&&n>=400)&&(a+=25,i.push("Fits within your budget range")),u==="virtual"&&((j=(w=t.services)==null?void 0:w.consultationTypes)!=null&&j.includes("video"))?(a+=15,i.push("Offers virtual consultations")):u&&((F=(R=(c=t.overview)==null?void 0:c.address)==null?void 0:R.city)!=null&&F.toLowerCase().includes(u.toLowerCase()))&&(a+=15,i.push("Located in your preferred area"));const o=((P=t.patientExperience)==null?void 0:P.nextAvailableAppointment)||"";(N==="this-week"&&o.includes("day")||N==="two-weeks"&&(o.includes("day")||o.includes("week")&&parseInt(o)<=2))&&(a+=10,i.push("Available within your preferred timeframe")),a+=Math.random()*5,i.length===0&&i.push("Good overall match for your needs"),i.length===1&&(((B=t.patientExperience)==null?void 0:B.overallRating)>4.5?i.push("Highly rated by patients"):((T=t.patientExperience)==null?void 0:T.recommendationRate)>90?i.push(`${t.patientExperience.recommendationRate}% of patients recommend this clinic`):i.push("Offers comprehensive treatment options"));const M=Math.min(99,Math.max(60,Math.round(a)));return{clinic:t,score:a,matchPercentage:M,matchReasons:i}}).sort((t,a)=>a.score-t.score).slice(0,5);q(r),z(!1)},[S,x,m,u,N]);const V=async s=>{C(!1);const r={email:s.email,name:s.name,quiz_responses:{condition:x||"",treatment_history:d.get("treatment-history")||"",priorities:d.get("priorities")||"",budget:m||"",location:u||"",urgency:N||""},matched_clinics:A.slice(0,5)},t=await ae.saveQuizUser(r);t.success?(console.log("User saved:",t.data),typeof window<"u"&&window.gtag&&window.gtag("event","quiz_email_captured",{event_category:"engagement",value:1})):console.error("Save failed:",t.error),Y(!0)},W=s=>{var r;(r=s.overview)!=null&&r.website&&window.open(s.overview.website,"_blank","noopener,noreferrer")},$=s=>{U(`/clinics/${s}`)};return D?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{title:"Your Medical Cannabis Clinic Matches - Personalized Results",description:"Your personalized medical cannabis clinic recommendations based on your quiz responses. Find the perfect UK clinic for your specific needs.",canonicalUrl:"https://comparetheleaf.co.uk/results",keywords:["clinic matches","personalized recommendations","medical cannabis results","clinic finder results"]}),e.jsx(J,{items:[{label:"Home",path:"/"},{label:"Results",path:"/results"}]}),e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:l?"Your Personalized Clinic Matches":"Your Top Clinic Matches"}),e.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:l?"Based on your responses, here are your best-matched clinics for your specific needs":"Enter your email to unlock detailed clinic information, pricing, and booking links"}),!l&&e.jsxs("button",{onClick:()=>C(!0),className:"mt-6 inline-flex items-center px-8 py-4 border border-transparent text-lg font-medium rounded-lg text-white bg-gradient-to-r from-blue-600 to-green-600 hover:from-blue-700 hover:to-green-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105",children:[e.jsx(X,{className:"h-5 w-5 mr-2"}),"Unlock Full Results",e.jsx(L,{className:"ml-2 h-5 w-5"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"space-y-6 mb-10",children:A.slice(0,l?5:3).map((s,r)=>{var t,a,i,k,E,n,o,M,h,p,g,f,v,b,w,j;return e.jsx("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 overflow-hidden border border-gray-200",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-14 h-14 bg-gradient-to-r from-blue-600 to-green-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mr-4",children:r+1}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:((t=s.clinic.overview)==null?void 0:t.name)||"Unknown Clinic"}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"text-lg font-semibold text-green-600 mr-4",children:[s.matchPercentage,"% match"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{value:Math.round(((a=s.clinic.patientExperience)==null?void 0:a.overallRating)||0),size:18}),e.jsxs("span",{className:"ml-1 text-sm text-gray-600",children:[((k=(i=s.clinic.patientExperience)==null?void 0:i.overallRating)==null?void 0:k.toFixed(1))||"N/A","(",((E=s.clinic.patientExperience)==null?void 0:E.totalReviews)||0,")"]})]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:["£",((o=(n=s.clinic.pricing)==null?void 0:n.initialConsultation)==null?void 0:o.price)||"TBC"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"consultation"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Why this clinic matches you:"}),e.jsx("ul",{className:"space-y-2",children:s.matchReasons.map((c,R)=>e.jsxs("li",{className:"flex items-start",children:[e.jsx(ee,{className:"h-5 w-5 text-green-500 mr-2 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-gray-700",children:c})]},R))})]}),l&&e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-gray-600 line-clamp-3",children:(M=s.clinic.overview)==null?void 0:M.description})}),l&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Follow-up:"}),e.jsxs("div",{className:"font-medium text-gray-900 mt-1",children:["£",((p=(h=s.clinic.pricing)==null?void 0:h.followUpConsultation)==null?void 0:p.price)||"TBC"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Annual cost:"}),e.jsxs("div",{className:"font-medium text-gray-900 mt-1",children:["£",((f=(g=s.clinic.pricing)==null?void 0:g.estimatedAnnualCost)==null?void 0:f.average)||"TBC"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Wait time:"}),e.jsx("div",{className:"font-medium text-gray-900 mt-1",children:((v=s.clinic.patientExperience)==null?void 0:v.nextAvailableAppointment)||"Contact clinic"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Location:"}),e.jsx("div",{className:"font-medium text-gray-900 mt-1",children:((w=(b=s.clinic.overview)==null?void 0:b.address)==null?void 0:w.city)||"Virtual"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-4 mt-6",children:l?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>W(s.clinic),className:"flex-1 bg-gradient-to-r from-blue-600 to-green-600 text-white px-6 py-3 rounded-lg hover:from-blue-700 hover:to-green-700 transition-all font-medium flex items-center justify-center shadow-md hover:shadow-lg",children:["Book Consultation",e.jsx(se,{className:"ml-2 h-4 w-4"})]}),e.jsxs("button",{onClick:()=>{var c;return $((c=s.clinic.overview)==null?void 0:c.id)},className:"flex-1 border border-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center justify-center",children:["View Full Profile",e.jsx(L,{className:"ml-2 h-4 w-4"})]})]}):e.jsxs("button",{onClick:()=>C(!0),className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center",children:[e.jsx(re,{className:"h-5 w-5 mr-2"}),"Unlock Booking & Details"]})})]})},((j=s.clinic.overview)==null?void 0:j.id)||r)})}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-green-600 rounded-lg p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Want to Compare These Clinics Side-by-Side?"}),e.jsx("p",{className:"text-lg text-blue-100 mb-6 max-w-2xl mx-auto",children:"Use our comparison tool to see detailed differences in pricing, services, and features."}),e.jsxs("button",{onClick:()=>U("/compare"),className:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-blue-600 bg-white hover:bg-gray-100 transition-colors",children:["Compare Clinics",e.jsx(L,{className:"ml-2 h-5 w-5"})]})]}),e.jsx("div",{className:"mt-8",children:e.jsx(te,{})})]}),e.jsx(ie,{isOpen:O,onClose:()=>C(!1),onSubmit:V})]})};export{me as default};
